const { response } = require("express");
const mongoose=require("mongoose");
const express= require("express");
const app=express();
app.use(express.urlencoded({extended: true}));
app.use(express.json());
const morgan=require("morgan");


app.use(morgan('tiny'));


require("dotenv/config");
const api=process.env.API_URL;
const {Products}=require("./product_models/products")




app.get(`${api}/products`,async (request,response)=> {

 const list=await Products.find();
response.send(list)}
);
app.post(`${api}/products`,(request,response)=> {

 const product=new Products({
    name:request.body.name,

    image:request.body.image,
    countInStock:request.body.countInStock,
    title:request.body.title
 
  



 })
 product.save().then((createproduct=>{
     response.status(201).json(createproduct)
 })).catch((err)=>response.status(500).json({
  error:err,
  success:false

 }))


 response.send(product);
 
}
);

mongoose.connect(process.env.CONNECTION_STRING)
.then(()=>{console.log('connection successfull')})
.catch(()=>{console.log('error')})

app.listen(5000,()=>{
console.log(api);
    console.log("welcome toserver");
});